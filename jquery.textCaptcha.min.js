/*!
* jQuery Text Captcha Plugin
* Copyright (c) 2012 Brian Ray
* Version: 0.2 (22-AUG-2012)
* Licensed under the DBAD license.
* Requires: jQuery v1.4.2 or later
*/

(function($){function log(){window.console&&console.log&&console.log("[captcha] "+Array.prototype.join.call(arguments," "))}var ver="0.1";$.fn.textCaptcha=function(a){var b={type:"text",method:"alphabetic",length:4};var a=$.extend(b,a);return this.each(function(){function q(){a.type=e[Math.floor(Math.random()*e.length)];a.method="random"}function r(){switch(a.type){case"text":a.method=f[Math.floor(Math.random()*f.length)];break;case"math":a.method=g[Math.floor(Math.random()*g.length)];break;case"number":a.method=h[Math.floor(Math.random()*h.length)];break}}function s(){switch(a.type){case"text":for(i=0;i<a.length;i++){k+=b[Math.floor(Math.random()*b.length)]}break;case"math":j=d[a.method];l=c[Math.floor(Math.random()*c.length)];m=c[Math.floor(Math.random()*c.length)];k=l+" "+j+" "+m;break;case"number":for(i=0;i<a.length;i++){k+=c[Math.floor(Math.random()*c.length)]}break}}function t(b){var c='<p><span id="type_captcha_method">'+o+'</span>: <span id="captcha">'+k+"</span></p>";c+='<input type="text" id="captcha_user" name="captcha_user" />';c+='<input type="hidden" id="captcha_type" name="captcha_type" value="'+a.type+'" />';c+='<input type="hidden" id="captcha_method" name="captcha_method" value="'+a.method+'" />';c+='<input type="hidden" id="captcha_value" name="captcha_value" value="'+k+'" />';b.children(":submit").before(c)}function u(){if($.inArray(a.method,p)<0){log("Type, method mismatch. \n type: "+a.type+" \n method: "+a.method);return false}}var b=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],c=[0,1,2,3,4,5,6,7,8,9],d={add:"+",multiply:"*"},e=["text","math","number"],f=["alphabetic","backwards","reverse_alphabetic"],g=["add","multiply"],h=["numeric","reverse_numeric"],j="",k="",l,m,n,o;if(a.type=="random"){q()}var p;switch(a.type){case"text":p=f;break;case"math":p=g;break;case"number":p=h;break}if(a.method=="random"){r()}s();u();switch(a.method){case"backwards":o="Type this string backwards";break;case"alphabetic":o="Type this string in alphabetical order";break;case"reverse_alphabetic":o="Type this string in reverse alphabetical order";break;case"add":o="Add these numbers";break;case"multiply":o="Multiply these numbers";break;case"numeric":o="Put these numbers in numeric order";break;case"reverse_numeric":o="Put these numbers in reverse numeric order";break}t($(this))})};$.fn.textCaptchaCheck=function(){var value,correct_value="",captcha_type=$("#captcha_type").val(),captcha_method=$("#captcha_method").val(),captcha_user=$("#captcha_user").val();if(captcha_type=="text"||captcha_type=="number"){value=$("#captcha_value").val().split("")}else{value=$("#captcha_value").val()}switch(captcha_method){case"alphabetic":value=value.sort();break;case"backwards":value=value.reverse();break;case"reverse_alphabetic":value=value.sort();value=value.reverse();break;case"add":value=eval(value);break;case"multiply":value=eval(value);break;case"numeric":value=value.sort(function(a,b){return a-b});break;case"reverse_numeric":value=value.sort(function(a,b){return a-b});value=value.reverse();break}if(captcha_type=="text"||captcha_type=="number"){correct_value=value.join("")}else{correct_value=value}if(captcha_user!=correct_value){return false}else{return true}}})(jQuery)